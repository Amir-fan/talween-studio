// Talween Studio - Google Apps Script
// Combined Email Service + Google Sheets Database API
// Copy this entire code into your Google Apps Script project

// Configuration - Set these values in your Apps Script
const API_KEY = '4808f174cdf9c9aa94cdd80d02d3b069fa04b49b'; // Set this in your Apps Script
const SPREADSHEET_ID = '1e8H6MdRGF0QJNpNL0NvUwJtWv89Wqk6hQsZIocpb-mI'; // Set this in your Apps Script
const SHEET_NAME = 'Talween Studio Data';

// Main entry point for GET requests (Database API)
function doGet(e) {
  try {
    // Check API key for database operations
    const apiKey = e.parameter.apiKey || e.parameter.key;
    if (!apiKey || apiKey !== API_KEY) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'Invalid or missing API key' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }

    const action = e.parameter.action || 'health';
    
    switch (action) {
      case 'health':
        return handleHealthCheck();
      case 'getUsers':
        return handleGetUsers();
      case 'getUser':
        return handleGetUser(e.parameter.userId);
      case 'syncCredits':
        return handleSyncCredits(e.parameter.userId);
      case 'clearAllData':
        return handleClearAllData();
      default:
        return ContentService
          .createTextOutput(JSON.stringify({ 
            success: false, 
            error: 'Invalid action' 
          }))
          .setMimeType(ContentService.MimeType.JSON);
    }
  } catch (error) {
    console.error('doGet error:', error);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Main entry point for POST requests (Email + Database API)
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    
    // Check if this is a database operation
    if (data.action && data.apiKey) {
      if (data.apiKey !== API_KEY) {
        return ContentService
          .createTextOutput(JSON.stringify({ 
            success: false, 
            error: 'Invalid API key' 
          }))
          .setMimeType(ContentService.MimeType.JSON);
      }
      
      return handleDatabaseAction(data);
    }
    
    // Otherwise, handle as email request
    return handleEmailRequest(data);
    
  } catch (error) {
    console.error('doPost error:', error);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Database Actions Handler
function handleDatabaseAction(data) {
  const { action } = data;
  
  switch (action) {
    case 'createUser':
      return handleCreateUser(data);
    case 'updateUser':
      return handleUpdateUser(data);
    case 'deleteUser':
      return handleDeleteUser(data.userId);
    case 'addCredits':
      return handleAddCredits(data.userId, data.amount);
    case 'deductCredits':
      return handleDeductCredits(data.userId, data.amount);
    case 'updateCredits':
      return handleUpdateCredits(data.userId, data.credits);
    case 'getUsers':
      return handleGetUsers();
    case 'getUser':
      return handleGetUser(data.userId);
    case 'syncCredits':
      return handleSyncCredits(data.userId);
    case 'clearAllData':
      return handleClearAllData();
    default:
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'Invalid database action' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
  }
}

// Health Check
function handleHealthCheck() {
  try {
    const sheet = getSheet();
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'Google Sheets API is working',
        spreadsheetId: SPREADSHEET_ID,
        sheetName: SHEET_NAME,
        totalUsers: sheet.getLastRow() - 1
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Health check failed: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Clear All Data
function handleClearAllData() {
  try {
    console.log('Clearing all data from Google Sheets...');
    
    const sheet = getSheet();
    const lastRow = sheet.getLastRow();
    
    if (lastRow > 1) {
      // Clear all data except headers (row 1)
      sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).clearContent();
      console.log(`Cleared ${lastRow - 1} rows of data`);
    } else {
      console.log('No data to clear');
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'All data cleared successfully',
        clearedRows: lastRow - 1
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    console.error('Error clearing all data:', error);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to clear data: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Get All Users
function handleGetUsers() {
  try {
    const sheet = getSheet();
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const users = [];
    
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const user = {};
      headers.forEach((header, index) => {
        user[header] = row[index];
      });
      users.push(user);
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        users: users,
        total: users.length
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to get users: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Get Single User
function handleGetUser(userId) {
  try {
    const sheet = getSheet();
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const idColumnIndex = headers.indexOf('ÿßŸÑŸÖÿπÿ±ŸÅ');
    
    if (idColumnIndex === -1) {
      throw new Error('ÿßŸÑŸÖÿπÿ±ŸÅ column not found');
    }
    
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      if (row[idColumnIndex] === userId) {
        const user = {};
        headers.forEach((header, index) => {
          user[header] = row[index];
        });
        return ContentService
          .createTextOutput(JSON.stringify({ 
            success: true, 
            user: user
          }))
          .setMimeType(ContentService.MimeType.JSON);
      }
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'User not found' 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to get user: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Create User
function handleCreateUser(data) {
  try {
    const sheet = getSheet();
    
    // Debug logging
    console.log('üîç GOOGLE APPS SCRIPT - handleCreateUser called');
    console.log('  - data:', JSON.stringify(data, null, 2));
    console.log('  - data.password:', data.password);
    console.log('  - data.password type:', typeof data.password);
    console.log('  - data.password length:', data.password ? data.password.length : 'undefined');
    
    // Check if user already exists
    const existingUser = findUserByEmail(sheet, data.email);
    if (existingUser) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User already exists with this email' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    // Prepare user data
    const userData = [
      data.id || generateId(),
      data.email || '',
      data.displayName || '',
      data.password || '',
      data.credits || 50,
      data.status || 'active',
      data.subscriptionTier || 'FREE',
      new Date().toISOString(),
      new Date().toISOString(), // last login
      0 // total spent
    ];
    
    console.log('  - userData array:', JSON.stringify(userData, null, 2));
    console.log('  - password in userData[3]:', userData[3]);
    
    sheet.appendRow(userData);
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'User created successfully',
        userId: userData[0]
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to create user: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Update User
function handleUpdateUser(data) {
  try {
    const sheet = getSheet();
    const userRow = findUserRow(sheet, data.userId);
    
    if (!userRow) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User not found' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    // Update specific fields
    const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    
    Object.keys(data).forEach(key => {
      const columnIndex = headers.indexOf(key);
      if (columnIndex !== -1 && key !== 'userId') {
        sheet.getRange(userRow, columnIndex + 1).setValue(data[key]);
      }
    });
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'User updated successfully' 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to update user: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Delete User
function handleDeleteUser(userId) {
  try {
    console.log('GOOGLE APPS SCRIPT - Deleting user:', userId);
    
    const sheet = getSheet();
    const userRow = findUserRow(sheet, userId);
    
    if (!userRow) {
      console.log('‚ùå User not found in Google Sheets');
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User not found' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    // Get user data before deletion for logging
    const userData = sheet.getRange(userRow, 1, 1, sheet.getLastColumn()).getValues()[0];
    const userEmail = userData[1]; // ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä column
    const userName = userData[2]; // ÿßŸÑÿßÿ≥ŸÖ column
    
    console.log('üìã User data to delete:', {
      userId: userId,
      email: userEmail,
      name: userName,
      row: userRow
    });
    
    // Delete the user row
    sheet.deleteRow(userRow);
    
    console.log('‚úÖ User deleted successfully from Google Sheets');
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'User deleted successfully',
        deletedUser: {
          id: userId,
          email: userEmail,
          name: userName
        }
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    console.error('‚ùå Error deleting user:', error);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to delete user: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Add Credits
function handleAddCredits(userId, amount) {
  try {
    const sheet = getSheet();
    const userRow = findUserRow(sheet, userId);
    
    if (!userRow) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User not found' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const creditsColumnIndex = getColumnIndex(sheet, 'ÿßŸÑŸÜŸÇÿßÿ∑');
    const currentCredits = sheet.getRange(userRow, creditsColumnIndex).getValue();
    const newCredits = currentCredits + parseInt(amount);
    
    sheet.getRange(userRow, creditsColumnIndex).setValue(newCredits);
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'Credits added successfully',
        newCredits: newCredits
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to add credits: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Deduct Credits
function handleDeductCredits(userId, amount) {
  try {
    const sheet = getSheet();
    const userRow = findUserRow(sheet, userId);
    
    if (!userRow) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User not found' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const creditsColumnIndex = getColumnIndex(sheet, 'ÿßŸÑŸÜŸÇÿßÿ∑');
    const currentCredits = sheet.getRange(userRow, creditsColumnIndex).getValue();
    const deductAmount = parseInt(amount);
    
    if (currentCredits < deductAmount) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'Insufficient credits' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const newCredits = currentCredits - deductAmount;
    sheet.getRange(userRow, creditsColumnIndex).setValue(newCredits);
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'Credits deducted successfully',
        newCredits: newCredits
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to deduct credits: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Update Credits (set specific amount)
function handleUpdateCredits(userId, credits) {
  try {
    const sheet = getSheet();
    const userRow = findUserRow(sheet, userId);
    
    if (!userRow) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User not found' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const creditsColumnIndex = getColumnIndex(sheet, 'ÿßŸÑŸÜŸÇÿßÿ∑');
    sheet.getRange(userRow, creditsColumnIndex).setValue(parseInt(credits));
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'Credits updated successfully',
        newCredits: credits
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to update credits: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Sync Credits
function handleSyncCredits(userId) {
  try {
    const sheet = getSheet();
    const userRow = findUserRow(sheet, userId);
    
    if (!userRow) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'User not found' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const userData = data[userRow - 1];
    const user = {};
    
    headers.forEach((header, index) => {
      user[header] = userData[index];
    });
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        user: user
      }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: 'Failed to sync credits: ' + error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Email Request Handler
function handleEmailRequest(data) {
  try {
    const { recipientEmail, emailType, templateData, userId } = data;
    
    if (!recipientEmail || !emailType) {
      return ContentService
        .createTextOutput(JSON.stringify({ 
          success: false, 
          error: 'Missing required fields' 
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    let subject = '';
    let htmlBody = '';
    
    switch (emailType) {
      case 'welcome':
        subject = 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà!';
        htmlBody = getWelcomeEmailTemplate(templateData);
        break;
        
      case 'passwordReset':
        subject = 'ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà';
        htmlBody = getPasswordResetEmailTemplate(templateData);
        break;
        
      case 'orderConfirmation':
        subject = 'ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ® - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà';
        htmlBody = getOrderConfirmationTemplate(templateData);
        break;
        
      case 'paymentSuccess':
        subject = 'ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ÿ®ŸÜÿ¨ÿßÿ≠ - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà';
        htmlBody = getPaymentSuccessTemplate(templateData);
        break;
        
      case 'creditsAdded':
        subject = 'ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ÿ•ŸÑŸâ ÿ≠ÿ≥ÿßÿ®ŸÉ - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà';
        htmlBody = getCreditsAddedTemplate(templateData);
        break;
        
      default:
        subject = 'ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÜ ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà';
        htmlBody = getDefaultEmailTemplate(templateData);
    }
    
    GmailApp.sendEmail(
      recipientEmail,
      subject,
      '',
      {
        htmlBody: htmlBody,
        name: 'ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà'
      }
    );
    
    console.log(`Email sent successfully to ${recipientEmail} for ${emailType}`);
    
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: true, 
        message: 'Email sent successfully',
        recipientEmail,
        emailType 
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    console.error('Error sending email:', error);
    return ContentService
      .createTextOutput(JSON.stringify({ 
        success: false, 
        error: error.toString() 
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Helper Functions
function getSheet() {
  const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
  let sheet = spreadsheet.getSheetByName(SHEET_NAME);
  
  if (!sheet) {
    // Create sheet with Arabic headers if it doesn't exist
    sheet = spreadsheet.insertSheet(SHEET_NAME);
    const headers = [
      'ÿßŸÑŸÖÿπÿ±ŸÅ',
      'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
      'ÿßŸÑÿßÿ≥ŸÖ',
      'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±',
      'ÿßŸÑŸÜŸÇÿßÿ∑',
      'ÿßŸÑÿ≠ÿßŸÑÿ©',
      'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÖÿ§ŸÉÿØ',
      'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°',
      'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ',
      'ÿßŸÑÿ®ŸÑÿØ',
      'ÿßŸÑŸÖÿØŸäŸÜÿ©',
      'ÿßŸÑÿπŸÖÿ±',
      'ÿßŸÑÿ¨ŸÜÿ≥',
      'ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖÿßÿ™',
      'ÿßŸÑŸÖÿµÿØÿ±',
      'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™'
    ];
    sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  }
  
  return sheet;
}

function findUserByEmail(sheet, email) {
  const data = sheet.getDataRange().getValues();
  const emailColumnIndex = data[0].indexOf('ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä');
  
  if (emailColumnIndex === -1) return null;
  
  for (let i = 1; i < data.length; i++) {
    if (data[i][emailColumnIndex] === email) {
      return data[i];
    }
  }
  return null;
}

function findUserRow(sheet, userId) {
  const data = sheet.getDataRange().getValues();
  const idColumnIndex = data[0].indexOf('ÿßŸÑŸÖÿπÿ±ŸÅ');
  
  if (idColumnIndex === -1) return null;
  
  for (let i = 1; i < data.length; i++) {
    if (data[i][idColumnIndex] === userId) {
      return i + 1; // Return 1-based row number
    }
  }
  return null;
}

function getColumnIndex(sheet, columnName) {
  const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  const index = headers.indexOf(columnName);
  return index === -1 ? 0 : index + 1; // Return 1-based column number
}

function generateId() {
  return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Professional Email Templates

function getWelcomeEmailTemplate(data) {
  return `
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { margin: 0; padding: 0; font-family: 'Cairo', Arial, sans-serif; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .tagline { color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 16px; font-weight: 400; }
        .content { padding: 40px 30px; }
        .icon-container { width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
        .icon { font-size: 36px; color: white; font-weight: bold; }
        .title { color: #1a202c; margin: 0 0 16px 0; font-size: 24px; font-weight: 600; text-align: center; }
        .message { color: #4a5568; font-size: 16px; line-height: 1.6; margin: 0 0 32px 0; text-align: center; }
        .gift-box { background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; padding: 24px; margin: 24px 0; text-align: center; border: 2px solid #f59e0b; }
        .gift-title { color: #92400e; margin: 0 0 8px 0; font-size: 20px; font-weight: 600; }
        .gift-amount { color: #92400e; margin: 0 0 8px 0; font-size: 24px; font-weight: 700; }
        .gift-description { color: #92400e; margin: 0; font-size: 14px; }
        .features { margin: 32px 0; }
        .feature-item { display: flex; align-items: center; margin: 16px 0; padding: 12px; background-color: #f7fafc; border-radius: 8px; }
        .feature-icon { font-size: 20px; margin-left: 12px; }
        .feature-text { color: #4a5568; font-size: 15px; margin: 0; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .cta-container { text-align: center; margin: 32px 0; }
        .footer { background-color: #f7fafc; padding: 24px 30px; text-align: center; border-top: 1px solid #e2e8f0; }
        .footer-text { color: #718096; font-size: 14px; margin: 0; }
        @media (max-width: 600px) {
          .container { margin: 0; border-radius: 0; }
          .content { padding: 30px 20px; }
          .header { padding: 30px 20px; }
          .logo { font-size: 24px; }
          .title { font-size: 20px; }
          .message { font-size: 15px; }
          .gift-box { padding: 20px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1 class="logo">ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ!</h1>
          <p class="tagline">ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿ≠ÿ≥ÿßÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠</p>
        </div>
        
        <div class="content">
          <div class="icon-container">
            <span class="icon">T</span>
            </div>
          
          <h2 class="title">ŸÖÿ±ÿ≠ÿ®ÿßŸã ${data.name || 'ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ'}!</h2>
          
          <p class="message">
            ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ®ŸÜÿ¨ÿßÿ≠! ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿßÿ≥ÿ™ŸÖÿ™ÿßÿπ ÿ®ÿ¨ŸÖŸäÿπ ŸÖŸäÿ≤ÿßÿ™ ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà Ÿàÿ®ÿØÿ° ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿßŸÑÿ≥ÿ≠ÿ±Ÿäÿ© ŸÖÿπ ÿ∑ŸÅŸÑŸÉ.
          </p>
          
          <div class="gift-box">
            <h3 class="gift-title">ŸáÿØŸäÿ™ŸÉ ÿßŸÑŸÖÿ¨ÿßŸÜŸäÿ©</h3>
            <p class="gift-amount">50 ŸÜŸÇÿ∑ÿ© ŸÖÿ¨ÿßŸÜŸäÿ©</p>
            <p class="gift-description">ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿáÿ∞Ÿá ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÇÿµÿµ ŸàÿµŸàÿ± ÿ™ŸÑŸàŸäŸÜ ŸÖÿÆÿµÿµÿ©!</p>
          </div>
          
          <div class="features">
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">1</span>
              <p class="feature-text">ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿµÿµ ŸÖÿÆÿµÿµÿ© ÿ®ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ</p>
          </div>
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">2</span>
              <p class="feature-text">ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµŸàÿµ ÿ•ŸÑŸâ ÿµŸÅÿ≠ÿßÿ™ ÿ™ŸÑŸàŸäŸÜ</p>
        </div>
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">3</span>
              <p class="feature-text">ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ± ÿ•ŸÑŸâ ÿµŸÅÿ≠ÿßÿ™ ÿ™ŸÑŸàŸäŸÜ</p>
      </div>
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">4</span>
              <p class="feature-text">ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÅŸä ŸÖŸÉÿ™ÿ®ÿ™ŸÉ ÿßŸÑÿ¥ÿÆÿµŸäÿ©</p>
        </div>
            </div>
          
          <div class="cta-container">
            <a href="${data.appUrl || 'https://italween.com'}" class="cta-button">
              ÿßÿ®ÿØÿ£ ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿßŸÑÿ¢ŸÜ
            </a>
          </div>
          </div>
        
        <div class="footer">
          <p class="footer-text">¬© 2024 ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

function getPasswordResetEmailTemplate(data) {
  return `
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { margin: 0; padding: 0; font-family: 'Cairo', Arial, sans-serif; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .tagline { color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 16px; font-weight: 400; }
        .content { padding: 40px 30px; }
        .icon-container { width: 80px; height: 80px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
        .icon { font-size: 36px; }
        .title { color: #1a202c; margin: 0 0 16px 0; font-size: 24px; font-weight: 600; text-align: center; }
        .message { color: #4a5568; font-size: 16px; line-height: 1.6; margin: 0 0 32px 0; text-align: center; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }
        .cta-container { text-align: center; margin: 32px 0; }
        .footer { background-color: #f7fafc; padding: 24px 30px; text-align: center; border-top: 1px solid #e2e8f0; }
        .footer-text { color: #718096; font-size: 14px; margin: 0; }
        .security-note { background-color: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 16px; margin: 24px 0; text-align: center; }
        .security-text { color: #991b1b; font-size: 14px; margin: 0; }
        .steps { margin: 32px 0; }
        .step-item { display: flex; align-items: flex-start; margin: 16px 0; padding: 16px; background-color: #f7fafc; border-radius: 8px; }
        .step-number { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; margin-left: 12px; flex-shrink: 0; }
        .step-text { color: #4a5568; font-size: 15px; margin: 0; }
        @media (max-width: 600px) {
          .container { margin: 0; border-radius: 0; }
          .content { padding: 30px 20px; }
          .header { padding: 30px 20px; }
          .logo { font-size: 24px; }
          .title { font-size: 20px; }
          .message { font-size: 15px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1 class="logo">ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</h1>
          <p class="tagline">ÿ™ÿ£ŸÖŸäŸÜ ÿ≠ÿ≥ÿßÿ®ŸÉ</p>
        </div>
        
        <div class="content">
          <div class="icon-container">
            <span class="icon" style="font-size: 24px; font-weight: bold; color: white;">&nbsp;&nbsp;&nbsp;</span>
            </div>
          
          <h2 class="title">ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</h2>
          
          <p class="message">
            ŸÖÿ±ÿ≠ÿ®ÿßŸã <strong>${data.name || 'ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ'}</strong>ÿå<br><br>
            ÿ™ŸÑŸÇŸäŸÜÿß ÿ∑ŸÑÿ®ÿßŸã ŸÑÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿÆÿßÿµÿ© ÿ®ÿ≠ÿ≥ÿßÿ®ŸÉ ŸÅŸä ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà.<br><br>
            ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿ≤ÿ± ÿ£ÿØŸÜÿßŸá ŸÑÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿÆÿßÿµÿ© ÿ®ŸÉ.
          </p>
          
          <div class="cta-container">
            <a href="${data.resetLink}" class="cta-button">
              ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±             </a>
          </div>
          
          <div class="steps">
            <div class="step-item">
              <div class="step-number">1</div>
              <p class="step-text">ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ£ÿπŸÑÿßŸá</p>
          </div>
            <div class="step-item">
              <div class="step-number">2</div>
              <p class="step-text">ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿ¨ÿØŸäÿØÿ© ŸÇŸàŸäÿ©</p>
            </div>
            <div class="step-item">
              <div class="step-number">3</div>
              <p class="step-text">ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©</p>
            </div>
          </div>
          
          <div class="security-note">
            <p class="security-text">
              <strong>ŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿ£ŸÖŸÜŸäÿ©:</strong> ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ∑ŸÑÿ® ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±ÿå ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ¨ÿßŸáŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿ£ŸÖÿßŸÜ. ÿ±ÿßÿ®ÿ∑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ ÿµÿßŸÑÿ≠ ŸÑŸÖÿØÿ© 24 ÿ≥ÿßÿπÿ© ŸÅŸÇÿ∑.
            </p>
          </div>
        </div>
        
        <div class="footer">
          <p class="footer-text">¬© 2024 ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

function getOrderConfirmationTemplate(data) {
  return `
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ® - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { margin: 0; padding: 0; font-family: 'Cairo', Arial, sans-serif; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #059669 0%, #047857 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .tagline { color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 16px; font-weight: 400; }
        .content { padding: 40px 30px; }
        .icon-container { width: 80px; height: 80px; background: linear-gradient(135deg, #059669, #047857); border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
        .icon { font-size: 36px; }
        .title { color: #1a202c; margin: 0 0 16px 0; font-size: 24px; font-weight: 600; text-align: center; }
        .message { color: #4a5568; font-size: 16px; line-height: 1.6; margin: 0 0 32px 0; text-align: center; }
        .order-details { background-color: #f0fdf4; border: 2px solid #22c55e; border-radius: 12px; padding: 24px; margin: 24px 0; }
        .order-title { color: #166534; margin: 0 0 16px 0; font-size: 18px; font-weight: 600; text-align: center; }
        .order-info { display: flex; justify-content: space-between; margin: 8px 0; }
        .order-label { color: #166534; font-weight: 600; }
        .order-value { color: #166534; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #059669, #047857); color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4); }
        .cta-container { text-align: center; margin: 32px 0; }
        .footer { background-color: #f7fafc; padding: 24px 30px; text-align: center; border-top: 1px solid #e2e8f0; }
        .footer-text { color: #718096; font-size: 14px; margin: 0; }
        @media (max-width: 600px) {
          .container { margin: 0; border-radius: 0; }
          .content { padding: 30px 20px; }
          .header { padding: 30px 20px; }
          .logo { font-size: 24px; }
          .title { font-size: 20px; }
          .message { font-size: 15px; }
          .order-info { flex-direction: column; gap: 4px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1 class="logo">ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿ∑ŸÑÿ®ŸÉ!</h1>
          <p class="tagline">ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ÿ´ŸÇÿ™ŸÉ</p>
        </div>
        
        <div class="content">
          <div class="icon-container">
            <span class="icon" style="font-size: 24px; font-weight: bold; color: white;">&nbsp;&nbsp;&nbsp;</span>
          </div>
          
          <h2 class="title">ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ÿ∑ŸÑÿ®ŸÉ!</h2>
          
          <p class="message">
            ŸÖÿ±ÿ≠ÿ®ÿßŸã <strong>${data.name || 'ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑÿπŸÖŸäŸÑ'}</strong>ÿå<br><br>
            ÿ™ŸÖ ÿ™ÿ£ŸÉŸäÿØ ÿ∑ŸÑÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠! ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿßÿ≥ÿ™ŸÖÿ™ÿßÿπ ÿ®ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿØŸÅŸàÿπÿ© ŸÅŸä ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà.
          </p>
          
          <div class="order-details">
            <h3 class="order-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®</h3>
            <div class="order-info">
              <span class="order-label">ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:</span>
              <span class="order-value">#${data.orderNumber || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span>
            </div>
            <div class="order-info">
              <span class="order-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:</span>
              <span class="order-value">$${data.totalAmount || '0'}</span>
            </div>
            <div class="order-info">
              <span class="order-label">ÿßŸÑÿ≠ÿßŸÑÿ©:</span>
              <span class="order-value">ÿ™ŸÖ ÿßŸÑÿ™ÿ£ŸÉŸäÿØ</span>
            </div>
            <div class="order-info">
              <span class="order-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®:</span>
              <span class="order-value">${new Date().toLocaleDateString('ar-SA')}</span>
            </div>
          </div>
          
          <div class="cta-container">
            <a href="${data.appUrl || 'https://italween.com'}" class="cta-button">
              ÿßÿ®ÿØÿ£ ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿßŸÑÿ¢ŸÜ
            </a>
          </div>
        </div>
        
        <div class="footer">
          <p class="footer-text">¬© 2024 ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

function getPaymentSuccessTemplate(data) {
  return `
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ÿ®ŸÜÿ¨ÿßÿ≠ - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { margin: 0; padding: 0; font-family: 'Cairo', Arial, sans-serif; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .tagline { color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 16px; font-weight: 400; }
        .content { padding: 40px 30px; }
        .icon-container { width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
        .icon { font-size: 36px; }
        .title { color: #1a202c; margin: 0 0 16px 0; font-size: 24px; font-weight: 600; text-align: center; }
        .message { color: #4a5568; font-size: 16px; line-height: 1.6; margin: 0 0 32px 0; text-align: center; }
        .success-box { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid #22c55e; border-radius: 12px; padding: 24px; margin: 24px 0; text-align: center; }
        .success-title { color: #166534; margin: 0 0 16px 0; font-size: 20px; font-weight: 600; }
        .success-message { color: #166534; margin: 0; font-size: 16px; }
        .payment-details { background-color: #f7fafc; border-radius: 12px; padding: 24px; margin: 24px 0; }
        .payment-title { color: #1a202c; margin: 0 0 16px 0; font-size: 18px; font-weight: 600; text-align: center; }
        .payment-info { display: flex; justify-content: space-between; margin: 8px 0; }
        .payment-label { color: #4a5568; font-weight: 600; }
        .payment-value { color: #1a202c; font-weight: 600; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .cta-container { text-align: center; margin: 32px 0; }
        .footer { background-color: #f7fafc; padding: 24px 30px; text-align: center; border-top: 1px solid #e2e8f0; }
        .footer-text { color: #718096; font-size: 14px; margin: 0; }
        @media (max-width: 600px) {
          .container { margin: 0; border-radius: 0; }
          .content { padding: 30px 20px; }
          .header { padding: 30px 20px; }
          .logo { font-size: 24px; }
          .title { font-size: 20px; }
          .message { font-size: 15px; }
          .payment-info { flex-direction: column; gap: 4px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1 class="logo">ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ÿ®ŸÜÿ¨ÿßÿ≠!</h1>
          <p class="tagline">ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ÿ´ŸÇÿ™ŸÉ</p>
        </div>
        
        <div class="content">
          <div class="icon-container">
            <span class="icon" style="font-size: 24px; font-weight: bold; color: white;">&nbsp;&nbsp;&nbsp;</span>
            </div>
          
          <h2 class="title">ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ÿ®ŸÜÿ¨ÿßÿ≠!</h2>
          
          <p class="message">
            ŸÖÿ±ÿ≠ÿ®ÿßŸã <strong>${data.name || 'ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑÿπŸÖŸäŸÑ'}</strong>ÿå<br><br>
            ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ! ÿ™ŸÖ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿØŸÅÿπÿ™ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠ Ÿàÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ ŸÅŸä ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà.
          </p>
          
          <div class="success-box">
            <h3 class="success-title">ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ!</h3>
            <p class="success-message">ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿßÿ≥ÿ™ŸÖÿ™ÿßÿπ ÿ®ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿØŸÅŸàÿπÿ©</p>
          </div>
          
          <div class="payment-details">
            <h3 class="payment-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿØŸÅÿπ</h3>
            <div class="payment-info">
              <span class="payment-label">ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ®:</span>
              <span class="payment-value">#${data.orderNumber || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span>
            </div>
            <div class="payment-info">
              <span class="payment-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ:</span>
              <span class="payment-value">$${data.totalAmount || '0'}</span>
            </div>
            <div class="payment-info">
              <span class="payment-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿØŸÅÿπ:</span>
              <span class="payment-value">${new Date().toLocaleDateString('ar-SA')}</span>
            </div>
            <div class="payment-info">
              <span class="payment-label">ÿ≠ÿßŸÑÿ© ÿßŸÑÿØŸÅÿπ:</span>
              <span class="payment-value">ŸÖŸÉÿ™ŸÖŸÑ</span>
            </div>
          </div>
          
          <div class="cta-container">
            <a href="${data.appUrl || 'https://italween.com'}" class="cta-button">
              ÿßÿ®ÿØÿ£ ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿßŸÑÿ¢ŸÜ             </a>
          </div>
        </div>
        
        <div class="footer">
          <p class="footer-text">¬© 2024 ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

function getCreditsAddedTemplate(data) {
  return `
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ - ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { margin: 0; padding: 0; font-family: 'Cairo', Arial, sans-serif; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .tagline { color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 16px; font-weight: 400; }
        .content { padding: 40px 30px; }
        .icon-container { width: 80px; height: 80px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
        .icon { font-size: 36px; }
        .title { color: #1a202c; margin: 0 0 16px 0; font-size: 24px; font-weight: 600; text-align: center; }
        .message { color: #4a5568; font-size: 16px; line-height: 1.6; margin: 0 0 32px 0; text-align: center; }
        .credits-box { background: linear-gradient(135deg, #fef3c7, #fde68a); border: 2px solid #f59e0b; border-radius: 12px; padding: 24px; margin: 24px 0; text-align: center; }
        .credits-title { color: #92400e; margin: 0 0 16px 0; font-size: 20px; font-weight: 600; }
        .credits-amount { color: #92400e; margin: 0 0 8px 0; font-size: 32px; font-weight: 700; }
        .credits-description { color: #92400e; margin: 0; font-size: 16px; }
        .features { margin: 32px 0; }
        .feature-item { display: flex; align-items: center; margin: 16px 0; padding: 12px; background-color: #f7fafc; border-radius: 8px; }
        .feature-icon { font-size: 20px; margin-left: 12px; }
        .feature-text { color: #4a5568; font-size: 15px; margin: 0; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }
        .cta-container { text-align: center; margin: 32px 0; }
        .footer { background-color: #f7fafc; padding: 24px 30px; text-align: center; border-top: 1px solid #e2e8f0; }
        .footer-text { color: #718096; font-size: 14px; margin: 0; }
        @media (max-width: 600px) {
          .container { margin: 0; border-radius: 0; }
          .content { padding: 30px 20px; }
          .header { padding: 30px 20px; }
          .logo { font-size: 24px; }
          .title { font-size: 20px; }
          .message { font-size: 15px; }
          .credits-box { padding: 20px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1 class="logo">ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑!</h1>
          <p class="tagline">ÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ•ÿ®ÿØÿßÿπ</p>
        </div>
        
        <div class="content">
          <div class="icon-container">
            <span class="icon" style="font-size: 24px; font-weight: bold; color: white;">&nbsp;&nbsp;&nbsp;</span>
            </div>
          
          <h2 class="title">ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ÿ•ŸÑŸâ ÿ≠ÿ≥ÿßÿ®ŸÉ!</h2>
          
          <p class="message">
            ŸÖÿ±ÿ≠ÿ®ÿßŸã <strong>${data.name || 'ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ'}</strong>ÿå<br><br>
            ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ÿ•ŸÑŸâ ÿ≠ÿ≥ÿßÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠! ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿßŸÑÿßÿ≥ÿ™ŸÖÿ™ÿßÿπ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ•ÿ®ÿØÿßÿπŸä.
          </p>
          
          <div class="credits-box">
            <h3 class="credits-title">ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ∂ÿßŸÅÿ©</h3>
            <p class="credits-amount">+${data.credits || '0'} ŸÜŸÇÿ∑ÿ©</p>
            <p class="credits-description">ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿáÿ∞Ÿá ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÇÿµÿµ ŸàÿµŸàÿ± ÿ™ŸÑŸàŸäŸÜ ŸÖÿÆÿµÿµÿ©!</p>
          </div>
          
          <div class="features">
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">1</span>
              <p class="feature-text">ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿµÿµ ŸÖÿÆÿµÿµÿ© ÿ®ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ÿ∑ŸÅÿßŸÑ</p>
            </div>
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">2</span>
              <p class="feature-text">ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµŸàÿµ ÿ•ŸÑŸâ ÿµŸÅÿ≠ÿßÿ™ ÿ™ŸÑŸàŸäŸÜ</p>
            </div>
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">3</span>
              <p class="feature-text">ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ± ÿ•ŸÑŸâ ÿµŸÅÿ≠ÿßÿ™ ÿ™ŸÑŸàŸäŸÜ</p>
            </div>
            <div class="feature-item">
              <span class="feature-icon" style="background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">4</span>
              <p class="feature-text">ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÅŸä ŸÖŸÉÿ™ÿ®ÿ™ŸÉ ÿßŸÑÿ¥ÿÆÿµŸäÿ©</p>
            </div>
          </div>
          
          <div class="cta-container">
            <a href="${data.appUrl || 'https://italween.com'}" class="cta-button">
              ÿßÿ®ÿØÿ£ ÿßŸÑÿ•ÿ®ÿØÿßÿπ ÿßŸÑÿ¢ŸÜ
            </a>
          </div>
        </div>
        
        <div class="footer">
          <p class="footer-text">¬© 2024 ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

function getDefaultEmailTemplate(data) {
  return `
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÜ ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { margin: 0; padding: 0; font-family: 'Cairo', Arial, sans-serif; background-color: #f8fafc; }
        .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 20px; text-align: center; }
        .logo { color: white; margin: 0; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .tagline { color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 16px; font-weight: 400; }
        .content { padding: 40px 30px; }
        .icon-container { width: 80px; height: 80px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
        .icon { font-size: 36px; }
        .title { color: #1a202c; margin: 0 0 16px 0; font-size: 24px; font-weight: 600; text-align: center; }
        .message { color: #4a5568; font-size: 16px; line-height: 1.6; margin: 0 0 32px 0; text-align: center; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 16px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .cta-container { text-align: center; margin: 32px 0; }
        .footer { background-color: #f7fafc; padding: 24px 30px; text-align: center; border-top: 1px solid #e2e8f0; }
        .footer-text { color: #718096; font-size: 14px; margin: 0; }
        @media (max-width: 600px) {
          .container { margin: 0; border-radius: 0; }
          .content { padding: 30px 20px; }
          .header { padding: 30px 20px; }
          .logo { font-size: 24px; }
          .title { font-size: 20px; }
          .message { font-size: 15px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1 class="logo">ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</h1>
          <p class="tagline">ÿπÿßŸÑŸÖ ÿßŸÑÿ•ÿ®ÿØÿßÿπ ŸàÿßŸÑŸÇÿµÿµ ÿßŸÑÿ≥ÿ≠ÿ±Ÿäÿ©</p>
        </div>
        
        <div class="content">
          <div class="icon-container">
            <span class="icon" style="font-size: 24px; font-weight: bold; color: white;">&nbsp;&nbsp;&nbsp;</span>
          </div>
          
          <h2 class="title">ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÜ ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà</h2>
          
          <p class="message">
            ŸÖÿ±ÿ≠ÿ®ÿßŸã <strong>${data.name || 'ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ'}</strong>ÿå<br><br>
            ${data.message || 'ŸÜÿ¥ŸÉÿ±ŸÉ ÿπŸÑŸâ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ŸÜÿ™ŸÖŸÜŸâ ŸÑŸÉ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ŸÖŸÖÿ™ÿπÿ©!'}
          </p>
          
          <div class="cta-container">
            <a href="${data.appUrl || 'https://italween.com'}" class="cta-button">
              ÿ≤ÿ± ŸÖŸàŸÇÿπŸÜÿß
            </a>
          </div>
        </div>
        
        <div class="footer">
          <p class="footer-text">¬© 2024 ÿ™ŸÑŸàŸäŸÜ ÿ≥ÿ™ŸàÿØŸäŸà. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

// Test function
function testEmail() {
  const testData = {
    recipientEmail: 'your-email@gmail.com',
    emailType: 'welcome',
    templateData: {
      name: 'Test User'
    },
    userId: 'test123'
  };
  
  const result = doPost({
    postData: {
      contents: JSON.stringify(testData)
    }
  });
  
  console.log(result.getContent());
}

// Test database function
function testDatabase() {
  const testData = {
    action: 'createUser',
    apiKey: API_KEY,
    email: 'test@example.com',
    displayName: 'Test User',
    credits: 50
  };
  
  const result = doPost({
    postData: {
      contents: JSON.stringify(testData)
    }
  });
  
  console.log(result.getContent());
}